{% extends 'requisitions/base.html' %}

{% block title %}欠料單物料彙總{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>欠料單物料彙總</h1>

    <form method="post" action="{% url 'update_shortage_arrival_dates' %}">
        {% csrf_token %}
        <table class="table table-striped table-hover table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>物料</th>
                    <th>物料說明</th>
                    <th>總欠料數量</th>
                    <th>相關訂單</th>
                    <th>預計入料</th>
                </tr>
            </thead>
            <tbody>
                {% for material in shortage_materials %}
                    <tr>
                        <td>{{ material.material_number }}</td>
                        <td>{{ material.item_name }}</td>
                        <td>{{ material.total_shortage }}</td>
                        <td>{{ material.orders_str }}</td>
                        <td>
                            {% if material.estimated_arrival_date %}
                                <span class="{% if material.estimated_arrival_date < today %}text-danger{% endif %}">
                                    目前設定: {{ material.estimated_arrival_date|date:"Y-m-d" }}
                                </span>
                                <br>
                            {% endif %}
                            <input type="date" name="arrival_date_{{ material.material_number }}" class="form-control form-control-sm mt-1">
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5" class="text-center">沒有欠料物料。</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="d-flex justify-content-end mt-3">
            <button type="submit" class="btn btn-primary">更新所有預計入料日期</button>
        </div>
    </form>
</div>
{% endblock %}