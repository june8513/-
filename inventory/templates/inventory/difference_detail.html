{% extends 'requisitions/base.html' %}

{% block title %}盤點差異報告 - {{ location_name }}{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="card">
        <div class="card-header">
            <h1 class="card-title">盤點差異報告 - {{ location_name }}</h1>
            <a href="{% url 'difference_location_list' %}" class="btn btn-secondary btn-sm">返回地點選擇</a>
            <a href="{% url 'export_differences_excel' location_name %}" class="btn btn-success btn-sm">匯出 Excel</a>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover">
                    <thead class="table-dark sticky-top">
                        <tr>
                            <th>儲格</th>
                            <th>物料</th>
                            <th>物料說明</th>
                            <th>系統庫存</th>
                            <th>實際盤點數量</th>
                            <th>差異</th>
                            <th>盤點人員</th>
                            <th>盤點時間</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for material in materials %}
                        <tr>
                            <td>{{ material.bin }}</td>
                            <td>{{ material.material_code }}</td>
                            <td>{{ material.material_description }}</td>
                            <td>{{ material.system_quantity }}</td>
                            <td>{{ material.latest_counted_quantity }}</td>
                            <td>
                                {% with difference=material.difference %}
                                    <span class="{% if difference > 0 %}text-success fw-bold{% elif difference < 0 %}text-danger fw-bold{% endif %}">
                                        {% if difference > 0 %}+{% endif %}{{ difference }}
                                    </span>
                                {% endwith %}
                            </td>
                            <td>{{ material.last_counted_by.username|default:"" }}</td>
                            <td>{{ material.last_counted_date|date:"Y-m-d H:i"|default:"" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="8" class="text-center">此地點沒有盤點差異的物料。</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
